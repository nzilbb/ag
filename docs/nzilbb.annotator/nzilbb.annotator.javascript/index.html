<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 2.0.0 from src/site/xhtml/index.xhtml at 2025-06-02
 | Rendered using Apache Maven Fluido Skin 2.1.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 2.0.0" />
    <title>nzilbb.annotator.javascript</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-2.1.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-2.1.0.min.js"></script>
  </head>
  <body>
    <div class="container-fluid container-fluid-top">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h1><a href="https://nzilbb.github.io/ag/"><img src="https://nzilbb.github.io/ag/images/labbcat.png" /> nzilbb.annotator.javascript</a></h1></div></div>
          <div class="pull-right"><div id="bannerRight"><h1><a href="https://www.canterbury.ac.nz/nzilbb/"><img src="https://nzilbb.github.io/ag/images/nzilbb.svg" /></a></h1></div></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2025-06-02<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 2.1.2<span class="divider">|</span></li>
      <li><a href="../../index.html">Annotation Graphs</a><span class="divider">/</span></li>
      <li><a href="../index.html">Annotators</a><span class="divider">/</span></li>

    <li class="active">nzilbb.annotator.javascript</li>
        <li class="pull-right"><span class="divider">|</span>
<a href="http://dx.doi.org/10.1016/j.csl.2017.01.004">Fromont (2017)</a></li>
        <li class="pull-right"><span class="divider">|</span>
<a href="https://labbcat.canterbury.ac.nz/">LaBB-CAT</a></li>
        <li class="pull-right"><a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">nzilbb.annotator.javascript</li>
    <li><a href="https://raw.githubusercontent.com/nzilbb/ag/refs/heads/main/bin/nzilbb.annotator.javascript.jar">Download</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
<a href="https://maven.apache.org/" class="builtBy" target="_blank"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn" class="span10">

<section><section><a id="Javascript_Annotator"></a>
<h2>Javascript Annotator</h2>


<p> The Javascript Annotator allows annotations to be generated by executing a
  program or expression written in JavaScript. </p> 


<p> The layer manager has two modes of operation: </p>
<dl>
  
<dt> Label Mapping </dt>
<dd> new annotation labels are generated from a small
    JavaScript expression operating on the label from a given source layer.</dd>      
  
<dt> Full Script </dt> 
<dd> a full script is given the whole annotation graph, which
    it can traverse, process, and add annotations to.</dd> 
</dl>

</section><section><a id="Label_Mapping"></a>
<h2 id="labelMapping"> Label Mapping </h2>


<p> The label of each annotation from the source layer directly generates the label
  of one annotation on the destination layer.  </p>


<p> For each distinct label on the source layer, the specified expression is executed
  on the label, and the result of the expression is saved on the destination
  layer. </p>


<p>Some illustrative examples:</p>

<ul>
  
<li><code>length</code> - saves the length of the source label on the destination layer,
    <br /> e.g. <q>test</q> &#x2192; <q>4</q> </li> 
  
<li><code>toUpperCase()</code> - converts all lowercase letters to uppercase,
    <br /> e.g. <q>test</q> &#x2192; <q>TEST</q> </li> 
  
<li><code>replace(/[aeiou]/g,&quot;&quot;)</code> - removes all vowels,
    <br /> e.g. <q>test</q> &#x2192; <q>tst</q> </li> 
  
<li><code>replace(/[aeiou]/g,&quot;V&quot;).replace(/[^aeiou]/g,&quot;C&quot;)</code>
    - replaces all vowels with V and all non-vowels with C,
    <br /> e.g. <q>test</q> &#x2192; <q>CVCC</q></li>
</ul>

</section><section><a id="Full_Script"></a>
<h2 id="script">Full Script</h2>


<p> The script is executed for each transcript, with a variable
  called <var>transcript</var> which stores the transcript's Annotation
  Graph. <var>transcript</var> can be traversed to inspect annotations, and can have
  annotations added to it (on this layer only), which will be saved back to
  LaBB-CAT's annotation store when the script completes. </p>


<p> The <var>transcript</var> variable is populated with annotations from the layers
  that are ticked on the panel to the right of the script. Only those layers will be
  available to the script, no other layers are loaded.</p>


<p> The script might look something like the following, which tags each word with its
  length:</p> 

<pre>
<span style="color:#8b4513;">// for each turn in the transcript</span>
<span style="color:#800080;">for</span> each (turn <span style="color:#800080;">in</span> transcript.all(&quot;turns&quot;)) {
&#160; <span style="color:#800080;">if</span> (annotator.cancelling) <span style="color:#800080;">break</span>; <span style="color:#8b4513;">// cancelled by the user</span>
&#160; <span style="color:#8b4513;">// for each word</span>
&#160; <span style="color:#800080;">for</span> each (word <span style="color:#800080;">in</span> turn.all(&quot;transcript&quot;)) {
&#160;&#160;&#160; <span style="color:#8b4513;">// tag the word with it's length</span>
&#160;&#160;&#160; word.createTag(&quot;length&quot;, &quot;length: &quot; + word.label.length());
&#160;&#160;&#160; log(&quot;Tagged word: &quot; + word.label);
&#160; } <span style="color:#8b4513;">// next word</span>
} <span style="color:#8b4513;">// next turn</span>
</pre>
</section></section>        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
<a rel='license' href='http://creativecommons.org/licenses/by-sa/2.0/'><img alt='CC-BY-SA Creative Commons Licence ' src='/ag/images/cc-by-sa.svg' title='This work is licensed under a Creative Commons Attribution-ShareAlike 2.0 Generic License' /></a><a rel='author' href='https://www.canterbury.ac.nz/nzilbb/'><img src='/ag/images/nzilbb.svg' alt='Te Kāhui Roro Reo | The New Zealand Institute of Language, Brain and Behaviour' title='🄯 NZILBB'></a>
        </div>
      </div>
    </footer>
  </body>
</html>
