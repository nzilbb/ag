<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <title>Pattern Tagger</title>
    <link rel="stylesheet" href="codemirror.css" type="text/css">
    <link rel="stylesheet" href="index.css" type="text/css">
    <script src="util.js" type="text/javascript"></script>
  </head>
  <body>
    <details><summary> The Javascript Layer Manager allows annotations to be generated by
        executing a program or expression written in JavaScript. </summary> 
    </details>
    
    <hr>
    
    <form method="POST" action="setTaskParameters" id="form">

      <div id="labelMappingDiv">
        <span><label><input type="radio" name="labelMapping" id="labelMappingFalse" value="false">
            Full Script</label></span>
        <span><label><input type="radio" name="labelMapping" id="labelMappingTrue" value="true">
            Label Mapping</label></span>
      </div>

      <div id="labelMappingConfiguration">
        
        <div class="field" title="Input layer from which annotations are selected">
          <label for="sourceLayerId">Source Layer</label>
          <span>
            <select id="sourceLayerId" name="sourceLayerId"></select>
          </span>
        </div>
        
        <div class="field" title="Output layer on which new annotations are added">
          <label for="destinationLayerId">Destination Layer</label>
          <span>
            <select id="destinationLayerId" name="destinationLayerId">
              <option disabled value="">[select layer]</option> <!-- force choice the first time -->
              <option>[add new layer]</option>         <!-- allow adding a new layer -->
            </select>
          </span>
        </div>

        <div id="labelMappingSettings">
<pre>
<span style="color:#8b4513;">// for each <span class="sourceName">source annotation</span> in the transcript</span>
<span style="color:#800080;">for</span> each (var <span class="sourceVar">annotation</span> <span style="color:#800080;">in</span> transcript.list(&quot;<span class="sourceName">layer</span>&quot;)) {
&nbsp;&nbsp; <span style="color:#8b4513;">// tag the <span class="sourceName">annotation</span></span>
&nbsp;&nbsp; <span id="mappingLine"><span class="sourceVar">annotation</span>.createTag("<span class="destinationName">annotation</span>", <span class="sourceVar">annotation</span>.label.<textarea id="labelScript" title="Expression to execute on the source annotation label - e.g. length"></textarea>);</span>
} <span style="color:#8b4513;">// next source annotation</span>
</pre>
        </div>
        
        <div class="field language-field" title="Transcript attribute for overall language">
          <label for="transcriptLanguageLayerId">Transcript Language Attribute</label>
          <span>
            <select id="transcriptLanguageLayerId" name="transcriptLanguageLayerId">
              <option value="">[none]</option>
            </select>
          </span>
        </div>
        <div class="field language-field"
             title="Layer for annotating phrases in a different language">
          <label for="phraseLanguageLayerId">Phrase Language Layer</label>
          <span>
            <select id="phraseLanguageLayerId" name="phraseLanguageLayerId">
              <option value="">[none]</option>
            </select>
          </span>
        </div>
        <div class="field language-field"
             id="languageField"
             title="Regular expression for the ISO language codes of the languages to target, or blank for all">
          <label for="language">Language</label>
          <span><input id="language" name="language" type="text" placeholder="Language"></span>
        </div>
        
      </div><!-- labelMappingConfiguration -->
      
      <div id="scriptConfiguration">
        <div id="loadControls">
          <label> Load script from file <input id="loadLocalScript" type="file"></label>
        </div>
        <div id="saveControls">
          <button class="form_button" id="saveLocalScript">Save script to file</button> 
        </div>
        <div id="newLayer">
          <button id="newLayerButton">New Layer</button>
          <div id="addingLayer" style="display: none;">
            <label>New Layer Name: <input id="newLayerId" type="text"></label>
            <label>Type:
              <select id="newLayerParentId">
                <option id="rootParent">Span Layer</option>
                <option id="turnParent">Phrase Layer</option>
                <option id="wordParent">Word Layer</option>
              </select>
            </label>
            <label>Alignment:
              <select id="newLayerAlignment">
                <option value="0" id="newLayerAlignment0">Not aligned</option>
                <option value="1">Points</option>
                <option value="2">Intervals</option>
              </select>
            </label>
          <button id="addLayerButton">Add Layer</button>
          </div><!--addingLayer-->
        </div><!--newLayer-->
        <div id="scriptDiv">
          <fieldset><legend> Script </legend>
            <textarea name="script" id="script"></textarea>
          </fieldset>
        </div><!-- scriptDiv -->
      </div><!--scriptConfiguration-->

      <div class="controls"><input type="submit" value="Set Parameters"></div>
    </form>
    
    <footer><div> Javascript Annotator <small id="version"></small> </div></footer>
    <script src="codemirror.js" type="text/javascript"></script>
    <script src="javascript.js" type="text/javascript"></script>
    <script src="index.js" type="text/javascript"></script>
  </body>
</html>
