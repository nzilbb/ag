<!DOCTYPE html>
<html><head><title>Javascript Annotator</title></head>
  <body>
    <h1>Javascript Annotator</h1>

    <p> The Javascript Layer Manager allows annotations to be generated by executing a
      program or expression written in JavaScript. </p> 
    
    <p> The layer manager has two modes of operation: </p>
    
    <dl>
      <dt> Label Mapping </dt>
      <dd> new annotation labels are generated from a small JavaScript expression
        operating on the label from a given source layer.</dd>
      
      <dt> Full Script </dt>
      <dd> a full script is given the whole annotation graph, which it can traverse,
        process, and add annotations to.</dd> 
    </dl>
    
    <h2 id="labelMapping"> Label Mapping </h2>
    
    <p> The label of each annotation from the source layer directly generates the label
      of one annotation on the destination layer.  </p>
    
    <p> For each distinct label on the source layer, the specified expression is executed
      on the label, and the result of the expression is saved on the destination
      layer. </p>
    
    <p>Some illustrative examples:</p>
    <ul>
      <li><code>length</code> - saves the length of the source label on the destination layer,
        <br> e.g. <q>test</q> → <q>4</q> </li> 
      <li><code>toUpperCase()</code> - converts all lowercase letters to uppercase,
        <br> e.g. <q>test</q> → <q>TEST</q> </li> 
      <li><code>replace(/[aeiou]/g,"")</code> - removes all vowels,
        <br> e.g. <q>test</q> → <q>tst</q> </li> 
      <li><code>replace(/[aeiou]/g,"V").replace(/[^aeiou]/g,"C")</code>
        - replaces all vowels with V and all non-vowels with C,
        <br> e.g. <q>test</q> → <q>CVCC</q></li>
    </ul>

    <h2 id="script">Full Script</h2>
    
    <p> The script is executed for each transcript, with a variable
      called <var>transcript</var> which stores the transcript's Annotation
      Graph. <var>transcript</var> can be traversed to inspect annotations, and can have
      annotations added to it (on this layer only), which will be saved back to
      LaBB-CAT&#39;s annotation store when the script completes. </p>
    
    <p> The <var>transcript</var> variable is populated with annotations from the layers
      that are ticked on the panel to the right of the script. Only those layers will be
      available to the script, no other layers are loaded.</p>
    
    <p> The script might look something like the following, which tags each word with its
      length:</p> 
<pre>
<span style="color:#8b4513;">// for each turn in the transcript</span>
<span style="color:#800080;">for</span> each (turn <span style="color:#800080;">in</span> transcript.list(&quot;turns&quot;)) {
&nbsp; <span style="color:#800080;">if</span> (annotator.cancelling) <span style="color:#800080;">break</span>; <span style="color:#8b4513;">// cancelled by the user</span>
&nbsp; <span style="color:#8b4513;">// for each word</span>
&nbsp; <span style="color:#800080;">for</span> each (word <span style="color:#800080;">in</span> turn.all(&quot;transcript&quot;)) {
&nbsp;&nbsp;&nbsp; <span style="color:#8b4513;">// tag the word with it's length</span>
&nbsp;&nbsp;&nbsp; word.createTag("length", &quot;length: &quot; + word.label.length());
&nbsp;&nbsp;&nbsp; log("Tagged word: " + word.label);
&nbsp; } <span style="color:#8b4513;">// next word</span>
} <span style="color:#8b4513;">// next turn</span>
</pre>
  </body>
</html>
