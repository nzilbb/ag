<h2>MFA</h2>

<p> The MFA annotator integrates with the
  <a href="https://montrealcorpustools.github.io/Montreal-Forced-Aligner/">
    Montreal Forced Aligner</a>, which can use words with phonemic transcriptions, and
  the corresponding audio, to force-align words and phones; i.e. determine the start
  and end time of each speech sound within each word, and thus the start/end times
  of the words. </p>

<p> The annotator can work in two modes: </p>
<ol>
  <li> <b>Train and Align</b> - acoustic models are trained on the data you want to
    align, which can be in any language as long as you have a pronunciation
    dictionary for it. </li>
  <li> <b>Pre-trained Models/Dictionaries</b> - pre-trained models and pronunciation
    dictionaries are supplied by the Montreal Forced Aligner and used for forced
    alignment. A list of languages for which dictionaries are available is
    <a href="https://montreal-forced-aligner.readthedocs.io/en/latest/user_guide/models/dictionary.html#pretrained-dictionaries">
      here</a>.
  </li>
</ol>

<p> The Montreal Forced Aligner is a third-party tool developed by Michael McAuliffe
  and others for time aligning orthographic and phonological forms from a pronunciation
  dictionary to orthographically transcribed audio files. It is
  <a href="https://github.com/MontrealCorpusTools/Montreal-Forced-Aligner/blob/main/LICENSE">
    open source software</a> based on the
  <a href="http://kaldi-asr.org/">Kaldi ASR toolkit</a>.
</p>

<h2> Install the Montreal Forced Aligner first </h2>

<p> This annotator cannot install the Montreal Forced Aligner. Under most
  circumstances you must manually install it in a location that is accessible to your
  annotation server user. </p>

<p> (The only exception to this is if your server is running in a Docker container,
  in which case, it's possible that your system has sufficient privileges to
  install MFA for itself. In this case, you can click the <i>Attempt to Install
    MFA</i> button when you install this annotator.) </p>

<p> Up-to-date installation instructions for the Montreal Forced Aligner are available
  here: <br>
  <a href="https://montreal-forced-aligner.readthedocs.io/en/latest/installation.html">
    https://montreal-forced-aligner.readthedocs.io/en/latest/installation.html</a>
</p>

<h3> Linux </h3>

<p> To install the Montreal Forced Aligner on Linux systems for all users, so that
  your web server can access it if required: </p>
<ol>
  <li> Download Miniconda: <br>
    <tt>wget https://repo.anaconda.com/miniconda/Miniconda3-py38_4.10.3-Linux-x86_64.sh</tt></li>
  <li> Start the installer: <br>
    <tt>sudo bash Miniconda3-py38_4.10.3-Linux-x86_64.sh</tt></li>
  <li> When asked the location to install Miniconda, use: <br>
    <tt>/opt/conda</tt></li>
  <li> When asked whether the installer should initialize Miniconda, this is
    unnecessary so you can respond <tt>no</tt></li>
  <li> Change ownership of the conda files): <br>
    <tt>sudo chown -R $USERNAME:$USERNAME /opt/conda</tt></li>
  <li> Make conda accessible to all users (so you web server can access MFA): <br>
    <tt>chmod -R go-w /opt/conda</tt><br>
    <tt>chmod -R go+rX /opt/conda</tt></li>
  <li> Install the Montreal Forced Aligner <br>
    <tt>/opt/conda/bin/conda create -n aligner -c conda-forge montreal-forced-aligner=3.2.1</tt></li>
</ol>

<h3> Windows </h3>

<p> To install the Montreal Forced Aligner on Windows systems for all users, so that
  your web server can access it if required: </p>
<ol>
  <li> Download the Miniconda installer.</li>
  <li> Start the installer by double-clicking it.</li>
  <li> When asked, select the <q>Install for all users</q> option. This will install
    conda somewhere like <br>
    <tt>C:\ProgramData\Miniconda3</tt></li>
  <li> When asked, tick the <q>add to PATH</q> option.</li>
  <li> Install the Montreal Forced Aligner by specifying a path to the environment <br>
    <tt>conda create -c conda-forge -p C:\ProgramData\Miniconda3\envs\aligner montreal-forced-aligner=3.2.1</tt></li>
</ol>

<h2> Upgrading Montreal Forced Aligner </h2>

<p> If the Montreal Forced Aligner is already installed an in use with the MFA Annotator,
  but you want to upgrade to its latest version, you can use the same command as for
  installing it, but use <tt>update</tt> instead of <tt>create</tt> - i.e.</p>

<p> On Linux: 
  <br><tt>/opt/conda/bin/conda update -n aligner -c conda-forge montreal-forced-aligner</tt>
</p>
<p> On Windows: 
  <br><tt>conda update -c conda-forge -p C:\ProgramData\Miniconda3\envs\aligner montreal-forced-aligner</tt>
</p>

<p> Alternatively, you can remove the <tt>aligner</tt> environment and re-create it again, using a specific version represented below by <var>n.n.n</var>: </p>

<ol>
  <li><tt>/opt/conda/bin/conda env remove -n aligner</tt></li>
  <li><tt>/opt/conda/bin/conda create -n aligner -c conda-forge montreal-forced-aligner=<var>n.n.n</var></tt></li>
</ol>

<p> You can find out information about recent versions here:
  <br><a href="https://montreal-forced-aligner.readthedocs.io/en/latest/installation.html#installing-older-versions-of-mfa">https://montreal-forced-aligner.readthedocs.io/en/latest/installation.html#installing-older-versions-of-mfa</a></p>
