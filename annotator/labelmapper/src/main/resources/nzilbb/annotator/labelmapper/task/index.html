<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <title> Label Mapper </title>
    <link rel="stylesheet" href="index.css" type="text/css">
    <script src="util.js" type="text/javascript"></script>
  </head>
  <body>
    <p> This annotator creates a mapping between the labels of two layers, by finding the
      minimum edit path between them. </p>
    
    <div id="settings-help">
      <p> The following settings are required: </p>
      
      <details><summary> Label Layer </summary>
        <p> This layer defines where the resulting annotations' labels come from. If a
          label from this layer cannot be mapped to a token, the label will be appended to a
          neighbouring token. </p>
      </details>
      
      <details><summary> Mapping Layer </summary>
        <p> This is the output layer; an annotation is create on this layer for each Token
          using corresponding labels from the Label Layer. </p>
        <p> If no <i>Phone Sub-mapping</i> is specified (see below), any Label Layer
          labels that cannot be directly mapped to a Token will be appended to a nearby
          Mapping Layer label; i.e. appended to the last one where possible. </p>
      </details>
      
      <details><summary> Comparator </summary>      
        <p> This setting determines how the <em>Label Layer</em> and the <em>Token Layer</em>
          labels might relate to each other: </p>
        <details><summary> Orthography → Orthography </summary>
          - a general text comparison is made; priority is given to linking characters
          that are the same (e.g. the same letter, regardless of case), then to
          linking characeters of the same general type (vowels to vowels, consonants
          to consonants, digits to digits, etc.)</details>
        <details><summary> Orthography → DISC </summary>
          - the label layer is assumed to be word orthography, and the token layer is
          assumed to be a DISC phonological layer.</details>
        <details><summary> Orthography → ARPAbet </summary>
          - the label layer is assumed to be word orthography, and the token layer is
          assumed to be a layer containing ARPAbet-based pronunciations (e.g. those that
          are used in the CMU Pronouncing Dictionary).</details>
        <details><summary> DISC → DISC </summary>
          - both are assumed to be DISC phonological layers; priority is given to
          linking identical consonants, then identical vowels, then allophones of the
          same phoneme (e.g. plosive and flapped /t/), then phonemes of the same type
          (e.g. diphthongs with diphthongs, monophthongs with monophthongs, plosives
          with plosives, etc.), then vowels together.</details>
        <details><summary> DISC → ARPAbet </summary>
          - the label layer is assumed to be a DISC phonological layer and the token
          layer is assumed to be a layer containing ARPAbet-based pronunciations (e.g. those that
          are used in the CMU Pronouncing Dictionary).</details>
        <details><summary> ARPAbet → DISC </summary>
          - the label layer is assumed to be a layer containing ARPAbet-based
          pronunciations (e.g. those that are used in the CMU Pronouncing Dictionary) and
          the token layers is assumed to be a DISC phonological layer.</details> 
      </details>
      
      <details><summary> Token Layer </summary>
        <p> This layer defines which tokens will be tagged. Each annotation on this layer
          will have one tag added, with one or more labels from the <em>Label Layer</em>,
          unless no correspondence can be found, in which case the token is not tagged. </p>
      </details>

      <details><summary> Phone Sub-mapping </summary>
        <p> The Sub-mapping option is available if:
          <ul>
            <li> The <b>Split labels</b> is set to <i>There are multiple annotations</i>, and</li>
            <li> The <b>Comparator</b> is set to <i>Orthography → Orthography</i> </li>
          </ul>
          i.e. you are mapping word tokens on one layer to word tokens on another layer. </p>

        <p> In this case, you also have the option of mapping phone tokens on one layer
          to phone tokens on another layer - i.e. you can compare two sets of word/phone
          annotations. </p>

        <p> The words on the <b>Label Layer</b> are assumed to be divided into phones
          that are on the <b>Sub-mapping Label Layer</b>, and
          the words on the <b>Token Layer</b> are assumed to be divided into phones that
          are on the <b>Sub-mapping Token Layer</b>, a nd the </p>
        
      </details>
    </div>
    
    <div id="examples">
      <details><summary> Some examples </summary>
        
        <details><summary>Tag each phone in a word with its likely counterpart in another
            phonemic transcription </summary> 
          <table>
            <tr>
              <th>Label Layer</th>
              <td><i>CELEX phonemes</i></td>
              <td colspan="7">dIfr@nt</td>
            </tr><tr>
              <th>Mapping Layer</th>
              <td><b>output</b></td>
              <td>d</td><td>I</td><td>f</td><td></td><td>r@</td><td>n</td><td>t</td>
            </tr><tr>
              <th>Comparator</th>
              <td><i>DISC → DISC</i></td>
              <td>↓</td><td>↓</td><td>↓</td><td></td><td>↓</td><td>↓</td><td>↓</td>
            </tr><tr>
              <th>Token Layer</th>
              <td><i>segments</i></td>
              <td>d</td><td>I</td><td>f</td><td>@</td><td>r</td><td>H</td><td>t</td>
            </tr>
          </table>
        </details>
        
        <details><summary> Phonemic encoding </summary>        
          <table>
            <tr>
              <th>Label Layer</th>
              <td><i>CMUDict phonemes</i></td>
              <td colspan="7">D IH1 F ER0 R AH0 N T</td>
            </tr><tr>
              <th>Mapping Layer</th>
              <td><i>Layer</i></td>
              <td>D</td><td>IH1</td><td>F</td><td></td><td><i>ER0</i> R</td><td>AH0</td><td>N</td><td>T</td>
            </tr><tr>
              <th>Comparator</th>
              <td><i>ARPAbet → DISC</i></td>
              <td>↓</td><td>↓</td><td>↓</td><td></td><td>↓</td><td>↓</td><td>↓</td><td>↓</td>
            </tr><tr>
              <th>Token Layer</th>
              <td><i>segments</i></td>
              <td>d</td><td>I</td><td>f</td><td></td><td>r</td><td>@</td><td>n</td><td>t</td>
            </tr>
          </table>
        </details>
        <details><summary> Map non-rhotic phones to their equivalent rhotic transcription </summary>    
          <table>
            <tr>
              <th>Label Layer</th>
              <td><i>Unisyn phonemes (rhotic)</i></td>
              <td colspan="7">f2rf2L@r</td>
            </tr><tr>
              <th>Mapping Layer</th>
              <td><b>output</b></td>
              <td>f</td><td>2</td><td>r</td><td>f</td><td>2</td><td>L</td><td>@r</td>
            </tr><tr>
              <th>Comparator</th>
              <td><i>DISC → DISC</i></td>
              <td>↓</td><td>↓</td><td>↓</td><td>↓</td><td>↓</td><td>↓</td><td>↓</td>
            </tr><tr>
              <th>Token Layer</th>
              <td><i>segments</i></td>
              <td>f</td><td>2</td><td>@</td><td>f</td><td>2</td><td>t</td><td>@</td>
            </tr>
          </table>
        </details>
        
        <details><summary> Map phones to their letters in the orthography </summary>    
          <table>
            <tr>
              <th>Label Layer</th>
              <td><i>orthography</i></td>
              <td colspan="7">firefighter</td>
            </tr><tr>
              <th>Mapping Layer</th>
              <td><b>output</b></td>
              <td>f</td><td>ir</td><td>e</td><td>f</td><td>igh</td><td>t</td><td>er</td>
            </tr><tr>
              <th>Comparator</th>
              <td><i>Orthography → DISC</i></td>
              <td>↓</td><td>↓</td><td>↓</td><td>↓</td><td>↓</td><td>↓</td><td>↓</td>
            </tr><tr>
              <th>Token Layer</th>
              <td><i>segments</i></td>
              <td>f</td><td>2</td><td>@</td><td>f</td><td>2</td><td>t</td><td>@</td>
            </tr>
          </table>  
        </details>

        <details><summary> Compare two independend word/phone alignments </summary>    
          <table>
            <tr class="label">
              <th>Label Layer</th>
              <td><i>CMUDictWord</i></td>
              <td colspan="8" class="word">different</td>
              <td colspan="7" class="word">firefighter</td>
            </tr><tr>
              <th>Split Labels</th>
              <td><i>There are multiple annotations</i></td>
              <td colspan="8" class="word">different</td>
              <td colspan="7" class="word">firefighter</td>
            </tr><tr class="mapping">
              <th>Mapping Layer</th>
              <td><b>output</b></td>
              <td colspan="8" class="word">different</td>
              <td colspan="7" class="word">firefighter</td>
            </tr><tr>
              <th>Comparator</th>
              <td><i>Orthography → Orthography</i></td>
              <td colspan="8">↓</td><td colspan="7">↓</td>
            </tr><tr class="token">
              <th>Token Layer</th>
              <td><i>orthography</i></td>
              <td colspan="8" class="word">different</td>
              <td colspan="7" class="word">firefighter</td>
            </tr>
            <tr>
              <th>Phone Sub-mapping</th>
              <td colspan="15">checked</td>
            </tr>
            <tr class="label">
              <th>Sub-mapping Label Layer</th>
              <td><i>P2FA</i></td>
              <td>D</td><td>IH1</td><td>F</td><td>ER0</td><td>R</td><td>AH0</td><td>N</td><td>T</td>
              <td>F</td><td>AY1</td><td>R</td><td>F</td><td>AY2</td><td>T</td><td>ER0</td>
            </tr><tr class="mapping">
              <th>Sub-mapping Mapping Layer</th>
              <td><b>sub-output</b></td>
              <td>D</td><td>IH1</td><td>F</td><td></td><td><i>ER0</i> R</td><td>AH0</td><td>N</td><td>T</td>
              <td>F</td><td>AY1</td><td>R</td><td>F</td><td>AY2</td><td>T</td><td>ER0</td>
            </tr><tr>
              <th>Comparator</th>
              <td><i>ARPAbet → DISC</i></td>
              <td>↓</td><td>↓</td><td>↓</td><td></td><td>↓</td><td>↓</td><td>↓</td><td>↓</td>
              <td>↓</td><td>↓</td><td>↓</td><td>↓</td><td>↓</td><td>↓</td><td>↓</td>
            </tr><tr class="token">
              <th>Sub-mapping Token Layer</th>
              <td><i>segments</i></td>
              <td>d</td><td>I</td><td>f</td><td></td><td>r</td><td>@</td><td>n</td><td>t</td>
              <td>f</td><td>2</td><td>@</td><td>f</td><td>2</td><td>t</td><td>@</td></td>
            </tr>
          </table>  
        </details>
      </details>
    </div>
    
    <hr>
    
    <form method="POST" action="setTaskParameters">
      <div class="field" title="Input layer from which the resulting annotations' labels come from">
        <label for="labelLayerId"> Label Layer </label>
        <span>
          <select id="labelLayerId" name="labelLayerId" required>
            <option disabled value="">[select layer]</option> <!-- force choice the first time -->
          </select>
        </span>
        <span id="exampleLabelLabel"></span>
      </div>
      <div class="field">
        <label> Split labels </label>
        <span>
          <!-- A set of radio buttons so that each option can have its own explanatory title -->
          <label title="Use the first annotation in the scope, split its label into characters, and map each to labels on the token layer.
(e.g. DISC word transcriptions to phones)">
            <input type="radio" id="splitLabels-char" name="splitLabels" value="char" checked> Split Label into Individual Characters </label>
          <label title="Use the first annotation in the scope, split its label on spaces, and map each to labels on the token layer.
(e.g. ARPAbet word transcriptions to phones)">
            <input type="radio" id="splitLabels-space" name="splitLabels" value="space"> Split Label on Spaces </label>
          <label title="Use all annotations in the scope, and do not split their labels.
(e.g. phone alignments to other phone alignments)">
            <input type="radio" id="splitLabels-" name="splitLabels" value="char"> There are multiple annotations </label>
        </span>
        <span id="exampleSplitLayers"></span>
      </div>
      <div class="field" title="Output layer mapping the Label layer to the Token layer">
        <label for="mappingLayerId"> Output Mapping Layer </label>
        <span>
          <select id="mappingLayerId" name="mappingLayerId">
            <option disabled value="">[select layer]</option> <!-- force choice the first time -->
            <option>[add new layer]</option>                  <!-- allow adding a new layer -->
          </select>
        </span>
        <span id="exampleMappingLabel">?</span>
      </div>
      <div class="field" title="How the Label layer and the Token layer labels relate to each other">
        <label for="comparator"> Comparator </label>
        <span>
          <select id="comparator" name="comparator">
            <option value="CharacterToCharacter"> Orthography → Orthography </option>
            <option value="OrthographyToDISC"> Orthography → DISC </option>
            <option value="OrthographyToArpabet"> Orthography → ARPAbet </option>
            <option value="DISCToDISC"> DISC → DISC </option>
            <option value="DISCToArpabet"> DISC → ARPAbet </option>
            <option value="ArpabetToDISC"> ARPAbet → DISC </option>
          </select>
        </span>
        <span id="exampleMapping">↓</span>
      </div>
      <div class="field" title="Which tokens will be tagged">
        <label for="tokenLayerId"> Token Layer </label>
        <span>
          <select id="tokenLayerId" name="tokenLayerId">
            <option disabled value="">[select layer]</option> <!-- force choice the first time -->
          </select>
        </span>
        <span id="exampleTokenLabel"></span>
      </div>

      <div title="Label Layer and Token Layer above identify words, which are subdivided into phones on the Sub-mapping Label Layer and Sub-mapping Token Layer below.">
        <label><input type="checkbox" id="submapping"> Phone Sub-mapping </label>
      </div>
      <div class="field" title="Input layer from which the sub-mapping annotations' labels come from">
        <label for="subLabelLayerId"> Sub-mapping Label Layer </label>
        <span>
          <select id="subLabelLayerId" name="subLabelLayerId" required>
            <option disabled value="">[select layer]</option> <!-- force choice the first time -->
          </select>
        </span>
        <span id="exampleSubLabelLabel"></span>
      </div>
      <div class="field" title="Output layer mapping the sub-mapping Label layer to the sub-mapping Token layer">
        <label for="subMappingLayerId"> Output Mapping Layer </label>
        <span>
          <select id="subMappingLayerId" name="subMappingLayerId">
            <option disabled value="">[select layer]</option> <!-- force choice the first time -->
            <option>[add new layer]</option>                  <!-- allow adding a new layer -->
          </select>
        </span>
        <span id="exampleSubMappingLabel">?</span>
      </div>
      <div class="field" title="How the sub-mapping Label layer and the sub-mapping Token layer labels relate to each other">
        <label for="subComparator"> Sub-mapping Comparator </label>
        <span>
          <select id="subComparator" name="subComparator">
            <option value="DISCToDISC"> DISC → DISC </option>
            <option value="DISCToArpabet"> DISC → ARPAbet </option>
            <option value="ArpabetToDISC"> ARPAbet → DISC </option>
            <!-- TODO option value="ArpabetToArpabet"> ARPAbet → Arpabet </option-->
          </select>
        </span>
        <span id="exampleSubMapping"></span>
      </div>
      <div class="field" title="Which tokens will be tagged for the sub-mapping">
        <label for="subTokenLayerId"> Sub-mapping Token Layer </label>
        <span>
          <select id="subTokenLayerId" name="subTokenLayerId">
            <option disabled value="">[select layer]</option> <!-- force choice the first time -->
          </select>
        </span>
        <span id="exampleSubTokenLabel"></span>
      </div>
      
      <div class="controls"><input type="submit" value="Set Parameters"></div>
    </form>
    
    <footer><div> Label Mapper <small id="version"></small> </div></footer>
    
    <script src="index.js" type="text/javascript"></script>
  </body>
</html>
