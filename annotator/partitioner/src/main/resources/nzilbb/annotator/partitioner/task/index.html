<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <title> Partitioner </title>
    <link rel="stylesheet" href="index.css" type="text/css">
    <script src="util.js" type="text/javascript"></script>
  </head>
  <body>
    <details>
      <summary> This annotator partitions annotation into blocks of
        either a given number of tokens, or a given number of
        seconds. The annotation label of each block is the number of
        tokens (or seconds) in that block. </summary> 
      
      <style type="text/css">
        <!--
        .example .span {
            border-top: 1px solid black;
            border-left: 1px solid black;
            border-right: 1px solid black;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
        }
        .example th {
            text-align: left;
        }
        .example td {
            text-align: center;
            padding-left: 10px;
            padding-right: 10px;
        }
        .example .partition {
            color: #96A339;
        }
        .example .partition .span {
            border-color: #96A339;
        }
        -->
      </style>

      <table class="example"><tbody>
          <caption>Example: Partititon Size = 2, Partition Alignment = start, with left-over tagging</caption>
          <tr>
            <th><em>Partition Boundary Layer:</em></th>
            <th>utterance</th>
            <td colspan="4" class="span">&nbsp;</td>
            <td colspan="5" class="span">&nbsp;</td>
          </tr>
          <tr class="partition">
            <th><em>Partition Layer:</em></th>
            <th>partition</th>
            <td colspan="2" class="span">2</td>
            <td colspan="2" class="span">2</td>
            <td colspan="2" class="span">2</td>
            <td colspan="2" class="span">2</td>
            <td colspan="2" class="span" title="Left-over annotation">1</td>
          </tr>
          <tr>
            <th><em>Count (token layer):</em></th>
            <th>word</th>
            <td>The</td>
            <td>quick</td>
            <td>brown</td>
            <td>fox</td>
            <td>jumps</td>
            <td>over</td>
            <td>the</td>
            <td>lazy</td>
            <td>dog.</td>
          </tr>
      </tbody></table>

      <p> For example, it can be used to mark blocks of 100 words long, from
        the beginning of each turn, or mark the middle 300 words of each
        topic tag. Leftover tokens can optionally be annotated or not.  The
        label of each block is the number of tokens in it, so leftover
        blocks can be distinguished from full blocks. </p>

      <p>The settings:</p>
      
      <dl>
        <dt>Partition Boundary Layer</dt>
        <dd>The Partition Boundary Layer defines which annotations
          will act as the outer bounds of the partitions. This layer already
          contains tokens on the <em>Count</em> layer (below) which will be
          counted for partitioning.</dd>
        <dt>Partition Alignment</dt>
        <dd>Partitions will be created within each annotation on
          the <em>Partition Boundary Layer</em> (above), starting from
          the start, middle, or end of each annotation. If <q>Start</q>
          is selected, the first token in each <em>Partition
            Boundary</em> annotation will also be the first token of a
          partition. If <q>End</q> is selected, the last token in
          each <em>Partition Boundary</em> annotation will also be the
          last token of a partition. If <q>Middle</q> is selected,
          partitions are generated from the middle of each
          <em>Partition Boundary</em> annotation outward.</dd> 
        <dt>Count</dt>
        <dd>Annotations on this layer will be counted in order to
        group them into partitions. You can also create time-based
        annotations (e.g. an interval every 5 seconds) by selecting
        the <q>[seconds]</q> option.</dd> 
        <dt>Partition Size</dt>
        <dd>This is the number of annotations on the <em>Count</em>
          layer which will make up each partition, or if you
          select <q>[seconds]</q> as the unit to <em>Count</em>, then
          this is the number of seconds length for each partition.</dd> 
        <dt>Number of Partitions</dt>
        <dd>This optional setting specifies the maximum number of
          partitions for each <em>Partition Boundary</em> annotation
          (including left-overs - see below).  For example, if you want
          only the middle <var>n</var> tokens, you would set this 1 (and
          set <em>Alignment</em> to <q>Middle</q>).  If left blank, the
          maximum possible number of full partitions will be created for
          each <em>Partition Boundary</em> annotation.</dd> 
        <dt>Annotate Left-overs</dt>
        <dd>Once all the required partitions
          containing <em>Partition-Size</em> tokens have been created,
          there are likely to be some remaining tokens left over, which
          have not been included in a partition.  If you tick
          the <em>Annotate Left-overs</em> option, then these remaining
          tokens will also be annotated, making the configuration
          consistent with the set-theoretic definition of a partition
          (i.e. including all elements of the superset) and introducing
          the possibility of partitions that contain fewer
          than <em>Partition-Size</em> tokens (which can be
          differentiated by the partition label).</dd> 
        <dt> Include ... </dt> <dd> In order to skip
          annotation of certain transcripts, e.g. you may wish to not
          partitition 'word-list' or 'reading-passage' transcripts,
          specify the ID of a transcript attribute layer that can be
          used to exclude or include transcripts for
          partitioning. e.g. to exclude transcripts on the basis of
          the <tt>transcript_type</tt> attribute, select
          the <q>transcript_type</q> layer. <br>
          This will result in a list of transcript types appearing below, and
          you can then un-tick the types you want to exclude from partitioning.
        </dd>
        <dt>Partition Layer</dt>
        <dd>This is the layer that partition annotations will be added to.
          <br> If this is a 'phrase' or 'span' layer, then there will be
          one annotation created per partition, and the label will be
          the number of tokens (or seconds) in the partition;
          i.e. the value of the <em>Partition Size</em> setting,
          except for 'left-over' annotations.
          <br> If this is a 'word' layer, then there will be one
          annotation created per token on the <em>Count</em> layer,
          and the label is the label of the token. </dd> 
      </dl>

      <h3> Examples </h3>

      <p> For example, if you want to mark blocks of 100 words long,
        from the beginning of each turn, you would use the following
        configuration: </p>
      <ul>
        <li>Partition Boundary Layer: turn</li>
        <li>Partition Alignment: Start</li>
        <li>Count: orthography</li>
        <li>Partition Size: 100</li>
        <li>Number of Partitions: (blank)</li>
        <li>Annotate Left-overs: ticked</li>
      </ul>
      
      <p> Alternatively, to mark the middle 300 words of each topic
        tag, you would use the following configuration: </p>
      <ul>
        <li>Partition Boundary Layer: topic</li>
        <li>Partition Alignment: Middle</li>
        <li>Count: orthography</li>
        <li>Partition Size: 300</li>
        <li>Number of Partitions: 1</li>
        <li>Annotate Left-overs: unticked</li>
      </ul>
      
      <p> Alternatively, to mark blocks of 5 seconds long, from the
        beginning of each turn, you would use the following configuration: </p>
      <ul>
        <li>Partition Boundary Layer: turn</li>
        <li>Partition Alignment: Start</li>
        <li>Count: [seconds]</li>
        <li>Partition Size: 5</li>
        <li>Number of Partitions: (blank)</li>
        <li>Annotate Left-overs: ticked</li>
      </ul>
      
    </details>

    <form method="POST" action="setTaskParameters" id="form">
      <div class="field"
           title="Tokens falling within annotations on this layer will be partitioned.">
        <label for="boundaryLayerId"> Partition Boundary Layer </label>
        <span><select id="boundaryLayerId" name="boundaryLayerId" required></select></span>
      </div>
      <div class="field"
           title="Partitions will be created within each annotation on the boundary layer, aligned with the start, middle, or end of each annotation.">
        <label for="alignment"> Partition Alignment </label>
        <span><select id="alignment" name="alignment" required>
	    <option>start</option>
	    <option>middle</option>
	    <option>end</option>
        </select></span>
      </div>
      <div class="field"
           title="Tokens within this layer will be counted to determine where the partitions are, or select 'seconds' for time-based partitioning">
        <label for="tokenLayerId"> Count </label>
        <span>
          <select id="tokenLayerId" name="tokenLayerId">
	    <option value="">[seconds]</option>
          </select>
        </span>
      </div>
      <div class="field"
           title="Number of tokens (or seconds) for each partition">
        <label for="partitionSize"> Partition Size </label>
        <span><input type="number" required
                     id="partitionSize" name="partitionSize"
                     min="1" step="any"> <span id="numTokensUnits">tokens</span></span>
      </div>
      <div class="field"
           title="Maximum number of partitions to create, including left-overs, or blank for no maximum.">
        <label for="maxPartitions"> Number of Partitions </label>
        <span><input type="number"
                     id="maxPartitions" name="maxPartitions"
                     min="1" step="any"></span>
      </div>
      <div class="field"
           title="Whether to annotate remaining tokens, if maximum number of partitions isn't reached within a bounding annotation.">
        <label for="leftOvers"> Annotate Left-overs </label>
        <span><input type="checkbox"
                     id="leftOvers" name="leftOvers"></span>
      </div>
      <div class="field" title="Transcript attribute for including/excluding transcripts">
        <div>
          <label for="excludeOnAttribute"> Include </label>
          <span>
            <select id="excludeOnAttribute" name="excludeOnAttribute">
              <option value="">[none]</option>
            </select>
          </span>
        </div>
        <input type="hidden" name="excludeOnAttributeValues" id="excludeOnAttributeValues">
        <div id="includeOnAttributeValues"
             title="Which transcript types to include">
        </div>
      </div>
      <div class="field" title="Output layer to which partitions are added">
        <label for="destinationLayerId"> Partition Layer </label>
        <span>
          <select id="destinationLayerId" name="destinationLayerId" required>
            <option disabled>[select layer]</option> <!-- force choice the first time -->
            <option>[add new layer]</option>         <!-- allow adding a new layer -->
          </select>
        </span>
      </div>
      <div class="field"
           title="What the labels are for partition annotations depend on the 'Count' setting above">
        <label>Partition Labels</label>
        <span id="partitionLabels"></span>
      </div>
      <div class="controls"><input type="submit" value="Set Parameters"></div>
    </form>
    
    <footer><div> Partitioner <small id="version"></small> </div></footer>
    
    <script src="index.js" type="text/javascript"></script>
  </body>
</html>
