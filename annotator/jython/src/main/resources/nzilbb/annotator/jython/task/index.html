<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <title>Jython Annotator</title>
    <link rel="stylesheet" href="codemirror.css" type="text/css">
    <link rel="stylesheet" href="index.css" type="text/css">
    <script src="util.js" type="text/javascript"></script>
  </head>
  <body>
    <details><summary> The Jython Annotator allows annotations to be generated by
        executing a program or expression written in Python. </summary> 
      
      <p>A full script is given the whole annotation graph, which it can traverse,
        process, and add annotations to.</p>
      
      <p> The script is executed for each transcript, with a variable
        called <var>transcript</var> which stores the transcript's Annotation
        Graph. <var>transcript</var> can be traversed to inspect annotations, and can have
        annotations added to it (on this layer only), which will be saved back to
        LaBB-CAT&#39;s annotation store when the script completes. </p>
      
      <p> The <var>transcript</var> graph is populated with annotations from the layers
        that are referring to in script.</p>
      
      <p> If your script creates new annotations on a layer that doesn't exist yet,
        (e.g. by using <code><var>annotation</var>.createTag("layer", <var>label</var>)</code>),
        then the mentioned layer will be automatically created as an interval span
        layer. If you want another type of layer (e.g. a word tag layer), be sure
        to click the <q>New Layer</q> button, fill in the details that appear, and
        click the <q>Define Layer</q> button, to ensure the right type of layer is
        created. </p>
      
      <p> The script might look something like the following, which tags each word with its
        length:</p> 
      <pre>
<span style="color:#8b4513;"># for each turn in the transcript</span>
<span style="color:#800080;">for</span> turn <span style="color:#800080;">in</span> transcript.all(&quot;turn&quot;):
&nbsp; <span style="color:#800080;">if</span> annotator.cancelling <span style="color:#800080;">break</span> <span style="color:#8b4513;"># cancelled by the user</span>
&nbsp; <span style="color:#8b4513;"># for each word</span>
&nbsp; <span style="color:#800080;">for</span> word <span style="color:#800080;">in</span> turn.all(&quot;word&quot;):
&nbsp;&nbsp;&nbsp; <span style="color:#8b4513;"># tag the word with it's length</span>
&nbsp;&nbsp;&nbsp; word.createTag("length", &quot;length: &quot; + str(len(word.label))
&nbsp;&nbsp;&nbsp; log("Tagged word: " + word.label)
            </pre>

    </details>
    
    <hr>
    
    <form method="POST" action="setTaskParameters" id="form">

      <div id="loadControls">
        <label> Load script from file <input id="loadLocalScript" type="file"></label>
      </div>
      <div id="saveControls">
        <button class="form_button" id="saveLocalScript">Save script to file</button> 
      </div>
      <div id="newLayer">
        <button id="newLayerButton"
                title="Create a new annotation layer for output"> New Layer </button>
        <div id="addingLayer" style="display: none;">
          <label>New Layer Name:
            <input id="newLayerId" type="text" title="ID for the new output layer"></label>
          <label>Type:
            <select id="newLayerParentId" title="What kind of layer is it?">
              <option id="rootParent">Span Layer</option>
              <option id="turnParent">Phrase Layer</option>
              <option id="wordParent">Word Layer</option>
            </select>
          </label>
          <label>Alignment:
            <select id="newLayerAlignment"
                    title="Does the layer mark out intervals or instants?">
              <option value="0" id="newLayerAlignment0">Not aligned</option>
              <option value="1">Points</option>
              <option value="2">Intervals</option>
            </select>
          </label>
          <button id="addLayerButton" title="Define the new layer"> Define Layer </button>
        </div><!--addingLayer-->
      </div><!--newLayer-->
      <div id="scriptDiv">
        <fieldset><legend> Script </legend>
          <textarea name="script" id="script"></textarea>
        </fieldset>
      </div><!-- scriptDiv -->
      
      <div class="controls"><input type="submit" value="Set Parameters"></div>
    </form>
    
    <footer><div> Jython Annotator <small id="version"></small> </div></footer>
    <script src="codemirror.js" type="text/javascript"></script>
    <script src="python.js" type="text/javascript"></script>
    <script src="index.js" type="text/javascript"></script>
  </body>
</html>
